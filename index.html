<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Treatment Planner - Evidence-Based Intervention Database</title>
  <style>
    /* Reset and Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary-color: #1a73e8;
      --primary-dark: #1557b0;
      --background: #f5f7fa;
      --surface: #ffffff;
      --text-primary: #202124;
      --text-secondary: #5f6368;
      --border-color: #dadce0;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.12);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    body {
      font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1a73e8 0%, #6c63ff 100%);
      color: white;
      padding: 2rem;
      text-align: center;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1rem;
    }

    /* Demographic Selection */
    .demographic-selection {
      flex: 1;
      padding: 3rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .demographic-selection h2 {
      text-align: center;
      margin-bottom: 2rem;
      font-size: 1.75rem;
      color: var(--text-primary);
    }

    .demographic-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      margin: 0 auto;
    }

    .demographic-card {
      background: var(--surface);
      border: 2px solid transparent;
      border-radius: var(--radius-lg);
      padding: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: var(--shadow-sm);
      text-align: left;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .demographic-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .demographic-card.child:hover { border-color: #4CAF50; }
    .demographic-card.adolescent:hover { border-color: #2196F3; }
    .demographic-card.sexualAbuse:hover { border-color: #9C27B0; }

    .demographic-card h3 {
      font-size: 1.5rem;
    }

    .demographic-card.child h3 { color: #4CAF50; }
    .demographic-card.adolescent h3 { color: #2196F3; }
    .demographic-card.sexualAbuse h3 { color: #9C27B0; }

    .demographic-card p {
      color: var(--text-secondary);
      font-size: 0.95rem;
    }

    .demographic-card .problem-count {
      display: inline-block;
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      margin-top: auto;
      align-self: flex-start;
    }

    .demographic-card.child .problem-count { background: #4CAF50; }
    .demographic-card.adolescent .problem-count { background: #2196F3; }
    .demographic-card.sexualAbuse .problem-count { background: #9C27B0; }

    /* Main Content Area */
    .main-content {
      flex: 1;
      padding: 1.5rem 2rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }

    .hidden {
      display: none !important;
    }

    /* Navigation Bar */
    .nav-bar {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .back-btn {
      background: var(--surface);
      border: 1px solid var(--border-color);
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.95rem;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .back-btn:hover {
      background: var(--background);
      color: var(--text-primary);
    }

    .current-demo {
      color: white;
      padding: 0.5rem 1rem;
      border-radius: var(--radius-sm);
      font-weight: 500;
    }

    /* Search Section */
    .search-section {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 2rem;
      box-shadow: var(--shadow-sm);
      margin-bottom: 1.5rem;
    }

    .search-section h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .search-container {
      position: relative;
      max-width: 600px;
    }

    .search-input {
      width: 100%;
      padding: 1rem 3rem 1rem 1.25rem;
      font-size: 1.1rem;
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      outline: none;
      transition: all 0.2s;
    }

    .search-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.15);
    }

    .clear-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 0.25rem;
      line-height: 1;
    }

    .clear-btn:hover {
      color: var(--text-primary);
    }

    /* Autocomplete Dropdown */
    .autocomplete-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--surface);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      margin-top: 0.5rem;
      z-index: 100;
      max-height: 400px;
      overflow-y: auto;
    }

    .dropdown-item {
      width: 100%;
      padding: 1rem 1.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: none;
      border: none;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      text-align: left;
      transition: background 0.2s;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: var(--background);
    }

    .problem-title {
      font-weight: 500;
      color: var(--text-primary);
    }

    .intervention-count {
      font-size: 0.85rem;
      color: var(--text-secondary);
      background: var(--background);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
    }

    /* Quick Select */
    .quick-select {
      margin-top: 1.5rem;
    }

    .quick-select h4 {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 0.75rem;
    }

    .quick-select-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .quick-btn {
      background: var(--background);
      border: 1px solid var(--border-color);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      color: var(--text-primary);
    }

    .quick-btn:hover {
      background: var(--primary-color);
      color: white;
      border-color: var(--primary-color);
    }

    /* Results Section */
    .results-section {
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .problem-header {
      background: linear-gradient(135deg, #1a73e8 0%, #6c63ff 100%);
      color: white;
      padding: 1.5rem 2rem;
      border-radius: var(--radius-lg);
      margin-bottom: 1.5rem;
    }

    .problem-header h2 {
      font-size: 1.5rem;
      margin-bottom: 0.75rem;
    }

    .stats {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .stat {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.9rem;
    }

    /* Content Sections */
    .section {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: 1.5rem 2rem;
      margin-bottom: 1.5rem;
      box-shadow: var(--shadow-sm);
    }

    .section h3 {
      font-size: 1.2rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--background);
    }

    /* Definition List */
    .definition-list,
    .goals-list {
      list-style: none;
    }

    .definition-list li,
    .goals-list li {
      padding: 0.75rem 0;
      padding-left: 1.5rem;
      position: relative;
      border-bottom: 1px solid var(--background);
      color: var(--text-secondary);
    }

    .definition-list li:last-child,
    .goals-list li:last-child {
      border-bottom: none;
    }

    .definition-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: var(--primary-color);
      font-weight: bold;
    }

    .goals-list li::before {
      content: "→";
      position: absolute;
      left: 0;
      color: #4CAF50;
      font-weight: bold;
    }

    /* Interventions */
    .interventions-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .intervention-card {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: var(--background);
      border-radius: var(--radius-sm);
      border-left: 4px solid var(--primary-color);
    }

    .intervention-number {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
      background: var(--primary-color);
      color: white;
      border-radius: 50%;
      font-size: 0.85rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .intervention-card p {
      color: var(--text-primary);
      line-height: 1.5;
      margin: 0;
    }

    /* Diagnoses Grid */
    .diagnoses-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }

    .diagnosis-card {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--background);
      border-radius: var(--radius-sm);
    }

    .diag-code {
      background: #9C27B0;
      color: white;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 600;
      font-family: monospace;
    }

    .diag-name {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Footer */
    .footer {
      background: var(--text-primary);
      color: var(--text-secondary);
      padding: 1.5rem 2rem;
      text-align: center;
    }

    .footer p {
      font-size: 0.85rem;
      margin: 0.25rem 0;
    }

    .footer p:first-child {
      color: white;
      font-weight: 500;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header {
        padding: 1.5rem 1rem;
      }

      .header h1 {
        font-size: 1.75rem;
      }

      .demographic-selection,
      .main-content {
        padding: 1rem;
      }

      .demographic-cards {
        grid-template-columns: 1fr;
      }

      .search-section,
      .section {
        padding: 1.25rem;
      }

      .problem-header {
        padding: 1.25rem;
      }

      .problem-header h2 {
        font-size: 1.25rem;
      }

      .stats {
        gap: 0.5rem;
      }

      .intervention-card {
        flex-direction: column;
        gap: 0.5rem;
      }

      .intervention-number {
        align-self: flex-start;
      }

      .diagnoses-grid {
        grid-template-columns: 1fr;
      }

      .nav-bar {
        flex-direction: column;
        align-items: stretch;
      }
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <h1>Treatment Planner</h1>
      <p>Evidence-Based Intervention Database</p>
    </header>

    <!-- Demographic Selection Screen -->
    <div id="demographic-selection" class="demographic-selection">
      <h2>Select Age Demographic / Population</h2>
      <div class="demographic-cards">
        <button class="demographic-card child" onclick="selectDemographic('child')">
          <h3>Children</h3>
          <p>Child Psychotherapy Treatment Planner</p>
          <span class="problem-count" id="child-count">Loading...</span>
        </button>
        <button class="demographic-card adolescent" onclick="selectDemographic('adolescent')">
          <h3>Adolescents</h3>
          <p>Adolescent Psychotherapy Treatment Planner</p>
          <span class="problem-count" id="adolescent-count">Loading...</span>
        </button>
        <button class="demographic-card sexualAbuse" onclick="selectDemographic('sexualAbuse')">
          <h3>Sexual Abuse/Offenses</h3>
          <p>Sexual Abuse Victim and Sexual Offender Treatment Planner</p>
          <span class="problem-count" id="sexualAbuse-count">Loading...</span>
        </button>
      </div>
    </div>

    <!-- Main Content Screen -->
    <div id="main-content" class="main-content hidden">
      <div class="nav-bar">
        <button class="back-btn" onclick="goBack()">← Back to Demographics</button>
        <div class="current-demo" id="current-demo-label"></div>
      </div>

      <!-- Search Section -->
      <div class="search-section">
        <h2>Search Symptoms / Diagnoses</h2>
        <div class="search-container">
          <input
            type="text"
            class="search-input"
            id="search-input"
            placeholder="Type to search (e.g., anxiety, depression, ADHD...)"
            oninput="handleSearch()"
            onfocus="showDropdown()"
          >
          <button class="clear-btn hidden" id="clear-btn" onclick="clearSearch()">×</button>
          <div class="autocomplete-dropdown hidden" id="dropdown"></div>
        </div>

        <div class="quick-select" id="quick-select">
          <h4>Quick Select:</h4>
          <div class="quick-select-grid" id="quick-select-grid"></div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="results-section" class="results-section hidden"></div>
    </div>

    <footer class="footer">
      <p>Based on Wiley PracticePlanners Series</p>
      <p>For clinical reference only. Professional judgment required.</p>
    </footer>
  </div>

  <script>
    // Treatment data will be embedded here
    let treatmentData = null;
    let currentDemographic = null;
    let selectedProblem = null;

    // Demographics configuration
    const DEMOGRAPHICS = {
      child: {
        label: 'Children',
        color: '#4CAF50'
      },
      adolescent: {
        label: 'Adolescents',
        color: '#2196F3'
      },
      sexualAbuse: {
        label: 'Sexual Abuse/Offenses',
        color: '#9C27B0'
      }
    };

    // Load treatment data
    async function loadData() {
      try {
        // Try to load from external JSON file first
        const response = await fetch('treatmentData.json');
        treatmentData = await response.json();
        updateCounts();
      } catch (e) {
        console.log('Loading embedded data...');
        // Data will be embedded below
      }
    }

    function updateCounts() {
      if (!treatmentData) return;
      document.getElementById('child-count').textContent =
        `${treatmentData.child?.length || 0} conditions`;
      document.getElementById('adolescent-count').textContent =
        `${treatmentData.adolescent?.length || 0} conditions`;
      document.getElementById('sexualAbuse-count').textContent =
        `${treatmentData.sexualAbuse?.length || 0} conditions`;
    }

    function selectDemographic(demo) {
      currentDemographic = demo;
      selectedProblem = null;

      document.getElementById('demographic-selection').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');

      const label = document.getElementById('current-demo-label');
      label.textContent = DEMOGRAPHICS[demo].label;
      label.style.backgroundColor = DEMOGRAPHICS[demo].color;

      document.getElementById('search-input').value = '';
      document.getElementById('clear-btn').classList.add('hidden');
      document.getElementById('results-section').classList.add('hidden');
      document.getElementById('quick-select').classList.remove('hidden');

      renderQuickSelect();
    }

    function goBack() {
      currentDemographic = null;
      selectedProblem = null;
      document.getElementById('demographic-selection').classList.remove('hidden');
      document.getElementById('main-content').classList.add('hidden');
    }

    function renderQuickSelect() {
      const grid = document.getElementById('quick-select-grid');
      const problems = treatmentData[currentDemographic] || [];

      grid.innerHTML = problems.slice(0, 12).map(p =>
        `<button class="quick-btn" onclick="selectProblem('${escapeHtml(p.problem)}')">${escapeHtml(p.problem)}</button>`
      ).join('');
    }

    function handleSearch() {
      const query = document.getElementById('search-input').value.toLowerCase();
      const clearBtn = document.getElementById('clear-btn');
      const dropdown = document.getElementById('dropdown');

      if (query) {
        clearBtn.classList.remove('hidden');
      } else {
        clearBtn.classList.add('hidden');
        dropdown.classList.add('hidden');
        document.getElementById('results-section').classList.add('hidden');
        document.getElementById('quick-select').classList.remove('hidden');
        return;
      }

      const problems = treatmentData[currentDemographic] || [];
      const filtered = problems.filter(p => {
        if (p.problem.toLowerCase().includes(query)) return true;
        if (p.definitions.some(d => d.toLowerCase().includes(query))) return true;
        if (p.diagnoses.some(d =>
          d.code.toLowerCase().includes(query) ||
          d.name.toLowerCase().includes(query)
        )) return true;
        return false;
      });

      if (filtered.length > 0 && !selectedProblem) {
        dropdown.classList.remove('hidden');
        dropdown.innerHTML = filtered.slice(0, 10).map(p => `
          <button class="dropdown-item" onclick="selectProblem('${escapeHtml(p.problem)}')">
            <span class="problem-title">${escapeHtml(p.problem)}</span>
            <span class="intervention-count">${p.interventions.length} interventions</span>
          </button>
        `).join('');
      } else {
        dropdown.classList.add('hidden');
      }
    }

    function showDropdown() {
      const query = document.getElementById('search-input').value;
      if (query && !selectedProblem) {
        handleSearch();
      }
    }

    function clearSearch() {
      document.getElementById('search-input').value = '';
      document.getElementById('clear-btn').classList.add('hidden');
      document.getElementById('dropdown').classList.add('hidden');
      document.getElementById('results-section').classList.add('hidden');
      document.getElementById('quick-select').classList.remove('hidden');
      selectedProblem = null;
    }

    function selectProblem(problemName) {
      const problems = treatmentData[currentDemographic] || [];
      selectedProblem = problems.find(p => p.problem === problemName);

      if (!selectedProblem) return;

      document.getElementById('search-input').value = selectedProblem.problem;
      document.getElementById('clear-btn').classList.remove('hidden');
      document.getElementById('dropdown').classList.add('hidden');
      document.getElementById('quick-select').classList.add('hidden');

      renderResults();
    }

    function renderResults() {
      if (!selectedProblem) return;

      const section = document.getElementById('results-section');
      section.classList.remove('hidden');

      let html = `
        <div class="problem-header">
          <h2>${escapeHtml(selectedProblem.problem)}</h2>
          <div class="stats">
            <span class="stat">${selectedProblem.definitions.length} symptoms</span>
            <span class="stat">${selectedProblem.interventions.length} interventions</span>
            <span class="stat">${selectedProblem.diagnoses.length} diagnoses</span>
          </div>
        </div>
      `;

      // Behavioral Definitions
      if (selectedProblem.definitions.length > 0) {
        html += `
          <div class="section">
            <h3>Behavioral Definitions / Symptoms</h3>
            <ul class="definition-list">
              ${selectedProblem.definitions.map(d => `<li>${escapeHtml(d)}</li>`).join('')}
            </ul>
          </div>
        `;
      }

      // Goals
      if (selectedProblem.goals.length > 0) {
        html += `
          <div class="section">
            <h3>Long-Term Goals</h3>
            <ul class="goals-list">
              ${selectedProblem.goals.map(g => `<li>${escapeHtml(g)}</li>`).join('')}
            </ul>
          </div>
        `;
      }

      // Interventions
      if (selectedProblem.interventions.length > 0) {
        html += `
          <div class="section">
            <h3>Therapeutic Interventions</h3>
            <div class="interventions-list">
              ${selectedProblem.interventions.map((intervention, idx) => `
                <div class="intervention-card">
                  <span class="intervention-number">${idx + 1}</span>
                  <p>${escapeHtml(intervention)}</p>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      // Diagnoses
      if (selectedProblem.diagnoses.length > 0) {
        html += `
          <div class="section">
            <h3>Diagnostic Suggestions (DSM-5/ICD-10)</h3>
            <div class="diagnoses-grid">
              ${selectedProblem.diagnoses.map(d => `
                <div class="diagnosis-card">
                  <span class="diag-code">${escapeHtml(d.code)}</span>
                  <span class="diag-name">${escapeHtml(d.name)}</span>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      }

      section.innerHTML = html;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(e) {
      const searchContainer = document.querySelector('.search-container');
      if (!searchContainer.contains(e.target)) {
        document.getElementById('dropdown').classList.add('hidden');
      }
    });

    // Initialize
    loadData();
  </script>

  <!-- Embedded Treatment Data -->
  <script src="treatmentData.js"></script>
</body>
</html>
